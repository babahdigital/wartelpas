version: '3'
services:
  mikhmon:
    build: . 
    container_name: mikhmon-pi-final
    restart: always
    ports:
      - "8081:80"
    environment:
      - TZ=Asia/Makassar
    volumes:
      # ==========================================
      # 1. PERSISTENSI DATA (WAJIB AMAN)
      # ==========================================
      - ./mikhmon_session:/var/www/html/mikhmon_session
      - ./db_data:/var/www/html/db_data
      - ./img:/var/www/html/img

      # ==========================================
      # 2. KONFIGURASI SERVER & PHP
      # ==========================================
      - ./include/config.php:/var/www/html/include/config.php
      - ./settings/settings.php:/var/www/html/settings/settings.php
      - ./include/readcfg.php:/var/www/html/include/readcfg.php
      - ./custom.ini:/usr/local/etc/php/conf.d/custom.ini
      - ./.htaccess:/var/www/html/.htaccess

      # ==========================================
      # 3. MODUL UTAMA (MAPPING SATU FOLDER)
      # ==========================================
      - ./report:/var/www/html/report        # Semua laporan
      - ./voucher:/var/www/html/voucher      # Template & print
      - ./dashboard:/var/www/html/dashboard  # Dashboard home
      - ./dhcp:/var/www/html/dhcp            # Modul DHCP
      - ./process:/var/www/html/process      # Background process

      # ==========================================
      # 4. MODUL HOTSPOT (FILE SPESIFIK)
      # ==========================================
      - ./hotspot/generateuser.php:/var/www/html/hotspot/generateuser.php
      - ./hotspot/users.php:/var/www/html/hotspot/users.php
      - ./hotspot/hotspotactive.php:/var/www/html/hotspot/hotspotactive.php
      - ./hotspot/hosts.php:/var/www/html/hotspot/hosts.php
      - ./hotspot/save_logout_time.php:/var/www/html/hotspot/save_logout_time.php
      # Keamanan: Overwrite file asli dengan file custom
      - ./hotspot/adduser.php:/var/www/html/hotspot/adduser.php
      - ./hotspot/quickuser.php:/var/www/html/hotspot/quickuser.php

      # ==========================================
      # 5. FILE ROOT & TOOLS (CORE SYSTEM)
      # ==========================================
      - ./admin.php:/var/www/html/admin.php
      - ./cekip.php:/var/www/html/cekip.php
      - ./error.php:/var/www/html/error.php
      - ./index.php:/var/www/html/index.php
      - ./lang/id.php:/var/www/html/lang/id.php

      # ==========================================
      # 6. INCLUDE LAINNYA
      # ==========================================
      - ./include/menu.php:/var/www/html/include/menu.php
      - ./include/login.php:/var/www/html/include/login.php
      - ./include/headhtml.php:/var/www/html/include/headhtml.php