
<!DOCTYPE html>
<html>
	<head>
		<title>Wartelpas </title>
		<meta charset="utf-8">
		<meta http-equiv="cache-control" content="private" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- Tell the browser to be responsive to screen width -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Theme color -->
		<meta name="theme-color" content="#3a4149" />
		<!-- Font Awesome -->
		<link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css" />
		<!-- Mikhmon UI -->
		<link rel="stylesheet" href="css/mikhmon-ui.dark.min.css">
		<!-- favicon -->
		<link rel="icon" href="./img/favicon.png" />
		<!-- jQuery -->
		<script src="js/jquery.min.js"></script>
		<!-- pace -->
		<link href="css/pace.dark.css" rel="stylesheet" />
		<link href="css/login.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/popup.css">
		<link rel="stylesheet" href="css/tooltips.css">
				<script src="js/pace.min.js"></script>
		<script src="js/popup.js" defer></script>
		<script src="js/tooltips.js" defer></script>

	</head>
	<body>
		<div class="wrapper">

			

<span style="display:none;" id="idto">disable</span>
<span style="display:none;" id="timer"></span>

<link rel="stylesheet" href="css/tooltips.css">
<script src="js/tooltips.js" defer></script>

<style>
    :root {
        --nav-bg: #1a2226;
        --nav-hover: #222d32;
        --nav-text: #9db2ba;
        --nav-active: #ffffff;
        --accent: #3c8dbc;
        --accent-audit: #d81b60;
        --header-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }

    body { margin-top: 60px; }

    .top-navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background-color: var(--nav-bg);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-shadow: var(--header-shadow);
        z-index: 1030;
        font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .wartelpas-brand {
        display: flex;
        align-items: center;
        text-decoration: none;
        margin-right: 30px;
        height: 100%;
    }

    .brand-logo {
        height: 50px;
        width: auto;
        object-fit: contain;
    }

    .nav-item { position: relative; }

    .mobile-toggle { display: none; font-size: 24px; color: #fff; cursor: pointer; padding: 10px; }

    .dropdown-item {
        display: block;
        padding: 12px 20px;
        color: var(--nav-text);
        text-decoration: none;
        border-bottom: 1px solid #344248;
        font-size: 13px;
    }

    .dropdown-item:last-child { border-bottom: none; }

    .dropdown-item:hover {
        background-color: #222d32;
        color: #fff;
        padding-left: 25px;
        transition: 0.2s;
    }

    .dropdown-item.audit-item { color: #ffb6c1; }
    .dropdown-item.audit-item:hover { color: #fff; }

    .dropdown-item i { margin-right: 10px; width: 15px; text-align: center; }

    .nav-right { display: flex; align-items: center; gap: 12px; padding-left: 20px; }
    .retur-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-left: 10px;
        padding: 2px 8px;
        border-radius: 12px;
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
        font-size: 11px;
        font-weight: 700;
        border: 1px solid rgba(245, 158, 11, 0.4);
        cursor: pointer;
        white-space: nowrap;
    }
    .retur-pill i { font-size: 11px; }
    .retur-pill-count {
        min-width: 18px;
        height: 18px;
        padding: 0 6px;
        border-radius: 10px;
        background: #f59e0b;
        color: #111827;
        font-weight: 800;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        line-height: 1;
    }
    .retur-pill.is-hidden { display: none; }
    .timer-badge {
        background: rgba(255,255,255,0.05);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        color: var(--nav-text);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 1px solid rgba(255,255,255,0.1);
        white-space: nowrap;
    }
    .db-tools {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 16px;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        color: var(--nav-text);
        font-size: 12px;
        text-decoration: none;
        transition: 0.2s;
        white-space: nowrap;
    }
    .db-tools:hover {
        background: rgba(255,255,255,0.08);
        color: #fff;
        transform: translateY(-1px);
    }
    .db-tools i { opacity: 0.8; }
    .db-status {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.1);
        color: #8aa2ad;
        font-size: 12px;
        transition: 0.2s;
    }
    .db-status.db-ok { color: #2ecc71; border-color: rgba(46,204,113,0.6); background: rgba(46,204,113,0.15); }
    .db-status.db-error { color: #e74c3c; border-color: rgba(231,76,60,0.6); background: rgba(231,76,60,0.15); }
    .db-status.db-ok i { animation: dbPulse 1.2s ease-in-out infinite; }
    @keyframes dbPulse {
        0% { transform: scale(1); opacity: 0.9; }
        50% { transform: scale(1.15); opacity: 1; }
        100% { transform: scale(1); opacity: 0.9; }
    }

    .logout-btn {
        height: 36px;
        width: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        color: var(--nav-text);
        transition: 0.3s;
        background: transparent;
    }
    .logout-btn:hover {
        background: rgba(216, 27, 96, 0.15);
        color: #ff4d4d;
        transform: scale(1.05);
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    #main { margin-left: 0; padding: 20px; }
    .main-container-fluid { width: 100%; }

    /* Override legacy sidebar layout */
    #main { margin-left: 0 !important; margin-top: 60px !important; }
    .sidenav { width: 0 !important; border-right: 0 !important; }
    #openNav, #closeNav, #cpage { display: none !important; }

    @media (max-width: 750px) {
        #brand { display: flex !important; }
    }

    @media (min-width: 993px) {
        .nav-links {
            display: flex; gap: 0; flex-grow: 1; align-items: center;
            list-style: none; margin: 0; padding: 0; height: 100%;
        }
        .nav-item { position: relative; height: 100%; }
        .nav-link {
            display: flex; align-items: center; gap: 8px;
            color: var(--nav-text); text-decoration: none;
            padding: 0 15px; height: 100%;
            font-size: 13.5px; font-weight: 600;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        .nav-link:hover { background-color: var(--nav-hover); color: var(--nav-active); }
        .nav-link.active { color: var(--nav-active); background-color: var(--nav-hover); border-bottom-color: var(--accent); }
        .nav-link.audit-link { color: #ffb6c1 !important; }
        .nav-link.audit-link.active { border-bottom-color: var(--accent-audit); }

        .dropdown-menu {
            display: none; position: absolute; top: 60px; left: 0;
            background-color: #2c3b41; min-width: 200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-radius: 0 0 4px 4px; z-index: 1040;
        }
        .nav-item:hover .dropdown-menu { display: block; animation: fadeIn 0.2s; }
    }

    @media (max-width: 992px) {
        .mobile-toggle { display: block; }
        .wartelpas-brand { margin-right: auto; }
        .nav-links {
            display: none;
            flex-direction: column;
            position: absolute; top: 60px; left: 0; right: 0;
            background-color: var(--nav-bg);
            height: auto; padding-bottom: 10px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            list-style: none; margin: 0; padding: 0;
        }
        .nav-links.show { display: flex !important; }
        .nav-link {
            display: flex; align-items: center; gap: 8px;
            color: var(--nav-text); text-decoration: none;
            padding: 0 20px; height: 45px;
            font-size: 14px; font-weight: 600;
            border-left: 3px solid transparent;
            width: 100%; box-sizing: border-box;
        }
        .nav-link.active { border-left-color: var(--accent); background: #1e282c; color: #fff; }
        .nav-link.audit-link.active { border-left-color: var(--accent-audit); }

        .dropdown-menu { display: none; position: static; background: #1a2226; box-shadow: none; width: 100%; }
        .nav-item.active-mobile .dropdown-menu { display: block; }
    }

</style>

    <nav class="top-navbar">
        <div class="mobile-toggle" onclick="toggleMenu()"><i class="fa fa-bars"></i></div>

        <a id="brand" class="wartelpas-brand" href="./?session=S3c7x9_LB">
            <img src="img/logo.png" alt="MIKHMON" class="brand-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <span style="display:none; color:#fff; font-weight:bold; font-size:18px;">WARTELPAS</span>
        </a>

        <ul class="nav-links" id="mainNav">
            <li class="nav-item">
                <a class="nav-link active" href="./?session=S3c7x9_LB">
                    <i class="fa fa-dashboard"></i> Dashboard                </a>
            </li>

            <li class="nav-item" onclick="toggleMobileSub(this)">
                <a class="nav-link " href="javascript:void(0)">
                    <i class="fa fa-users"></i> Pengguna <i class="fa fa-caret-down" style="margin-left:auto;font-size:10px;"></i>
                </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="./?hotspot=users&profile=all&session=S3c7x9_LB"><i class="fa fa-list"></i> Daftar User</a>
                    <a class="dropdown-item" href="./?hotspot-user=generate&session=S3c7x9_LB"><i class="fa fa-user-plus"></i> Generate</a>
                </div>
            </li>


            <li class="nav-item" onclick="toggleMobileSub(this)">
                <a class="nav-link " href="javascript:void(0)">
                    <i class="fa fa-gear"></i> Perangkat <i class="fa fa-caret-down" style="margin-left:auto;font-size:10px;"></i>
                </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="./?hotspot=active&session=S3c7x9_LB"><i class="fa fa-gear"></i> User Aktif</a>
                    <a class="dropdown-item" href="./?hotspot=hosts&session=S3c7x9_LB"><i class="fa fa-laptop"></i> Host Terhubung</a>
                    <a class="dropdown-item" href="./?hotspot=cookies&session=S3c7x9_LB"><i class="fa fa-hourglass"></i> Cookies</a>
                    <a class="dropdown-item" href="./?hotspot=dhcp-leases&session=S3c7x9_LB"><i class="fa fa-sitemap"></i> DHCP Leases</a>
                </div>
            </li>

            <li class="nav-item" onclick="toggleMobileSub(this)">
                <a class="nav-link " href="javascript:void(0)">
                    <i class="fa fa-money"></i> Laporan Penjualan <i class="fa fa-caret-down" style="margin-left:auto;font-size:10px;"></i>
                </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="./?report=selling&idbl=jan2026&session=S3c7x9_LB"><i class="fa fa-line-chart"></i> Laporan Penjualan</a>
                    <a class="dropdown-item audit-item" href="./?report=audit_session&session=S3c7x9_LB"><i class="fa fa-check-square-o"></i> Audit Keuangan</a>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link " href="./?report=whatsapp&session=S3c7x9_LB">
                    <i class="fa fa-whatsapp"></i> WhatsApp
                </a>
            </li>
                        <li class="nav-item">
                <a class="nav-link" href="./admin.php?id=sessions">
                    <i class="fa fa-gear"></i> Pengaturan Admin                </a>
            </li>
                    </ul>

        <div class="nav-right">
                                        <a id="db-backup" class="db-tools" href="javascript:void(0)" title="Backup Database" onclick="runBackupAjax()">
                    <i class="fa fa-database"></i> Backup
                </a>
                                        <a id="db-restore" class="db-tools" href="javascript:void(0)" title="Restore Backup Terbaru" onclick="runRestoreAjax()">
                    <i class="fa fa-history"></i> Restore
                </a>
                                        <a class="retur-pill " id="retur-menu-pill" href="javascript:void(0)" onclick="return openReturMenuPopup(event);" title="Permintaan Retur Pending">
                    <i class="fa fa-undo"></i> Retur
                    <span class="retur-pill-count" id="retur-menu-count">1</span>
                </a>
                        <span class="timer-badge" title="Waktu Saat Ini">
                <i class="fa fa-clock-o"></i> <span id="timer_val">--:--</span>
            </span>
            <span id="db-status" class="db-status" title="Kesehatan Database">
                <i class="fa fa-heart"></i>
            </span>
            <a id="logout" class="logout-btn" href="./?hotspot=logout&session=S3c7x9_LB" title="Keluar">
                <i class="fa fa-sign-out fa-lg"></i>
            </a>
        </div>
    </nav>

    

<div id="sidenav" style="display:none"></div>
<a id="openNav" href="javascript:void(0)" style="display:none"></a>
<a id="closeNav" href="javascript:void(0)" style="display:none"></a>
<div id="overL" style="display:none"></div>

<style>
    .btn-print.btn-default-dark { background:#343a40; color:#fff; border:1px solid #4b5259; }
    .btn-print.btn-default-dark:hover { background:#3d434a; color:#fff; }
</style>

<script>
    function toggleMenu() {
        var x = document.getElementById("mainNav");
        if (x.className === "nav-links") {
            x.className += " show";
        } else {
            x.className = "nav-links";
        }
    }

    function toggleMobileSub(el) {
        if (window.innerWidth <= 992) {
            el.classList.toggle("active-mobile");
        }
    }

    window.addEventListener('resize', function() {
        if (window.innerWidth > 992) {
            var x = document.getElementById("mainNav");
            if (x) x.classList.remove("show");
            var items = document.querySelectorAll('.nav-item.active-mobile');
            items.forEach(function(item) {
                item.classList.remove('active-mobile');
            });
        }
    });

    function updateRealTimeBadge() {
        var el = document.getElementById('timer_val');
        var fallback = document.getElementById('timer');
        if (!el && !fallback) return;
        var now = new Date();
        var dateStr = now.toLocaleDateString('id-ID', {
            day: '2-digit',
            month: 'short',
            year: 'numeric'
        });
        var timeStr = now.toLocaleTimeString('id-ID', { hour12: false });
        var full = dateStr + ' ' + timeStr;
        if (el) el.textContent = full;
        if (fallback) fallback.textContent = full;
    }

    window.__isSuperAdminFlag = true;
    window.__returMenuData = {"count":1,"items":[{"id":1,"created_at":"2026-01-31 03:59:13","request_date":"2026-01-31","voucher_code":"47uzst","blok_name":"","reason":"Coba aja sulu","profile_name":"10 Menit","blok_guess":"BLOK-A"}]};
    window.__returBlokNames = {"A":"ANUGRAH","B":"BERKAH","C":"CENDIKIA","D":"DINAYA","E":"EDUKATORIS","F":"FIDARSA"};
    window.__returSession = "S3c7x9_LB";
    window.__backupKey = "kX8gerJCDnsEn3GWbk5FCRHfpujZBpja2O3lbHvToWE=";

    document.addEventListener('DOMContentLoaded', function(){
        if (window.jQuery) {
            $(".connect").click(function(){
                notify("Menghubungkan...");
                connect(this.id)
            });
            $(".slang").change(function(){
                notify("Memuat...");
                stheme(this.value)
            });
        }
        updateRealTimeBadge();
        setInterval(updateRealTimeBadge, 1000);
        if (typeof window.updateDbStatus === 'function') {
            window.updateDbStatus();
            setInterval(window.updateDbStatus, 30000);
        }
        if (typeof window.updateBackupStatus === 'function') {
            window.updateBackupStatus();
            setInterval(window.updateBackupStatus, 60000);
        }
    });
</script>

<div id="notify"><div class="message"></div></div>
<div id="temp"></div>

<div id="ajax-overlay" class="overlay-backdrop">
    <div class="overlay-modal" id="ajax-modal-container">
        <div class="overlay-icon-box">
            <i id="ajax-overlay-icon" class="fa fa-circle-o-notch fa-spin"></i>
        </div>
        <div class="overlay-title" id="ajax-overlay-title">Processing</div>
        <div class="overlay-message" id="ajax-overlay-text">Mohon tunggu sebentar...</div>
        <button id="ajax-overlay-close" type="button" class="overlay-btn" onclick="hideOverlayNotice()">
            Tutup
        </button>
    </div>
</div>


<div id="main">
<div id="loading" class="lds-dual-ring" ></div><div class="main-container main-container-fluid" style="display:none"><link rel="stylesheet" href="css/dashboard-clean-pro.css">

<script type="text/javascript">
    var testDate = "";
    function withTestDate(url) {
        if (testDate && testDate.length === 10) {
            return url + "&test_date=" + encodeURIComponent(testDate);
        }
        return url;
    }
    function changeMonth(m) {
        var chartWrap = $("#chart_container");
        if (!chartWrap.length) chartWrap = $("#r_2_content");
        var loadingBar = $("#loading-halus");
        if (loadingBar.length) loadingBar.show();
        var chartDone = false;
        var logsDone = false;
        $(".month-tab").removeClass("active");
        $(".month-tab[data-month='" + m + "']").addClass("active");
        function reflowCharts() {
            if (window.Highcharts && window.Highcharts.charts) {
                window.Highcharts.charts.forEach(function(chart) {
                    if (chart && chart.reflow) {
                        chart.reflow();
                    }
                });
            }
        }
        function finishLoading() {
            if (chartDone && logsDone && loadingBar.length) loadingBar.hide();
        }
        chartWrap.css("opacity", "0.7");
        $("#r_2_content").html('<div style="text-align:center; padding:50px; color:#ccc;">Memproses grafik...</div>');
        $("#tabel_riwayat").html('<tr><td colspan="5" class="text-center" style="padding:20px;">Memuat...</td></tr>');
        $("#row-count").text("Memuat...");

        $.get("./dashboard/aload.php?session=S3c7x9_LB&load=hotspot&m=" + m)
            .done(function(data) {
                $("#r_2_content").html(data);
                chartWrap = $("#chart_container");
                if (!chartWrap.length) chartWrap = $("#r_2_content");
                chartWrap.css("opacity", "1");
                setTimeout(function() {
                    $(window).trigger('resize');
                    reflowCharts();
                }, 300);
            })
            .fail(function() {
                $("#r_2_content").html('<div style="text-align:center; padding:50px; color:#c33;"><i class="fa fa-warning"></i> Gagal memuat grafik.</div>');
            })
            .always(function() {
                chartDone = true;
                finishLoading();
            });

        setTimeout(function() {
            $.get(withTestDate("./dashboard/aload.php?session=S3c7x9_LB&load=logs&m=" + m))
                .done(function(dataLogs) {
                    if(dataLogs.trim() == "") {
                        $("#tabel_riwayat").html('<tr><td colspan="5" class="text-center text-muted" style="padding:20px;">Belum ada transaksi.</td></tr>');
                        $("#row-count").text("0 transaksi ditemukan");
                    } else {
                        $("#tabel_riwayat").html(dataLogs);
                        formatUptimeCells();
                        var rowCount = $("#tabel_riwayat tr:not(.text-center)").length;
                        if (rowCount > 10) rowCount = 10;
                        $("#row-count").text("Menampilkan " + rowCount + " transaksi");
                    }
                })
                .fail(function() {
                    $("#tabel_riwayat").html('<tr><td colspan="5" class="text-center text-danger">Gagal koneksi server.</td></tr>');
                    $("#row-count").text("Error loading data");
                })
                .always(function() {
                    logsDone = true;
                    finishLoading();
                });
        }, 500);
    }

    function updateDashboard() {
        $.getJSON(withTestDate("./dashboard/aload.php?load=live_data&session=S3c7x9_LB"), function(data) {
            $('#kpi-active').text(data.active);
            $('#kpi-sold').text(data.sold);
            $('#kpi-income').text('Rp ' + data.income);
            $('#kpi-est').text('Proyeksi: Rp ' + data.est_income);

            if (parseInt(data.ghost || 0, 10) > 0) {
                $('#ghost-tag').show();
            } else {
                $('#ghost-tag').hide();
            }

            if (data.audit_status === 'LOSS') {
                $('#audit-box').removeClass('border-audit border-warning').addClass('border-loss');
                $('#audit-status').text('LOSS')
                    .css('color', 'var(--accent-red)');
            } else if (parseInt(data.ghost || 0, 10) > 0) {
                $('#audit-box').removeClass('border-audit border-loss').addClass('border-warning');
                $('#audit-status').html('<i class="fa fa-search"></i> GHOST')
                    .css('color', 'var(--accent-yellow)');
            } else {
                $('#audit-box').removeClass('border-loss border-warning').addClass('border-audit');
                $('#audit-status').html('<i class="fa fa-check-circle"></i> CLEAR')
                    .css('color', 'var(--accent-green)');
            }

            $('#audit-val').html('<strong>Selisih:</strong> Rp ' + data.audit_val);

            var detail = '';
            if (data.audit_detail) {
                detail += '<div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:6px;">';

                if (parseInt(data.audit_detail.ghost || 0, 10) > 0) {
                    detail += '<span style="background:rgba(231,76,60,0.15); color:#e74c3c; padding:3px 8px; border-radius:4px; font-size:10px; font-weight:600;">';
                    detail += '<i class="fa fa-times-circle"></i> Kerugian: ' + data.audit_detail.ghost + ' Lbr</span>';
                }

                if (data.audit_detail.cash_expected) {
                    detail += '<span style="background:rgba(46,204,113,0.15); color:#2ecc71; padding:3px 8px; border-radius:4px; font-size:10px; font-weight:600;">';
                    detail += '<i class="fa fa-money"></i> Pendapatan: Rp ' + data.audit_detail.cash_expected + '</span>';
                }

                detail += '</div>';
            }
            $('#audit-detail').html(detail);
            var visibleRows = $("#tabel_riwayat tr:not(.text-center)").length;
            if (visibleRows > 10) visibleRows = 10;
            $("#row-count").text("Menampilkan " + visibleRows + " transaksi");
            formatUptimeCells();
            setTimeout(optimizeTableLayout, 50);
        });
    }

    function formatUptimeCells() {
        $('#tabel_riwayat tr').each(function() {
            var $tds = $(this).find('td');
            if ($tds.length < 5) return;
            var $uptime = $tds.eq(4);
            var val = ($uptime.text() || '').trim();
            var m = val.match(/^(\d{1,2}):(\d{2}):(\d{2})$/);
            if (m) {
                var hh = parseInt(m[1], 10) || 0;
                var mm = parseInt(m[2], 10) || 0;
                var ss = parseInt(m[3], 10) || 0;
                var parts = [];
                if (hh > 0) parts.push(hh + 'h');
                if (mm > 0 || hh > 0) parts.push(mm + 'm');
                parts.push(ss + 's');
                $uptime.text(parts.join(''));
            }
        });
    }

    function optimizeTableLayout() {
        var $container = $('.table-container');
        var $table = $container.find('table');
        var $indicator = $('.scroll-indicator');

        if (!$table.length) return;

        var containerWidth = $container.width();
        var tableWidth = $table[0].scrollWidth;

        if (window.innerWidth >= 769) {
            if (tableWidth <= containerWidth) {
                $container.css('overflow-x', 'hidden');
                $indicator.hide();
            } else {
                $container.css('overflow-x', 'auto');
                $indicator.show();
            }
        }

        if (window.innerWidth <= 768) {
            var isLandscape = window.innerWidth > window.innerHeight;
            $table.toggleClass('mobile-landscape', isLandscape);

            if (isLandscape) {
                $container.css('overflow-x', 'hidden');
            }
        }

        $('#last-update').text(new Date().toLocaleTimeString('id-ID', {
            hour: '2-digit',
            minute: '2-digit'
        }));
    }

    function updateLiveWindow() {
        var now = new Date();
        var parts = new Intl.DateTimeFormat('id-ID', {
            timeZone: 'Asia/Makassar',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        }).formatToParts(now);
        var hh = 0;
        var mm = 0;
        parts.forEach(function(p) {
            if (p.type === 'hour') hh = parseInt(p.value, 10) || 0;
            if (p.type === 'minute') mm = parseInt(p.value, 10) || 0;
        });

        var minutes = (hh * 60) + mm;
        var start = (8 * 60);
        var end = (18 * 60) + 15;
        var isLive = minutes >= start && minutes < end;

        if (isLive) {
            $('.live-window').show();
        } else {
            $('.live-window').hide();
        }
    }

    $(document).ready(function() {
        $("#r_1_display").load("./dashboard/aload.php?session=S3c7x9_LB&load=sysresource #r_1_content_raw");
        changeMonth(1);
        updateDashboard();
        setInterval(updateDashboard, 10000);
        updateLiveWindow();
        setInterval(updateLiveWindow, 60000);
        setInterval(function() {
            $("#r_1_display").load("./dashboard/aload.php?session=S3c7x9_LB&load=sysresource #r_1_content_raw");
        }, 10000);

        optimizeTableLayout();
        $(document).ajaxComplete(function() {
            setTimeout(optimizeTableLayout, 50);
        });

        $(".month-tab").on("click", function() {
            var m = $(this).data("month");
            if (m) changeMonth(m);
        });
        var resizeTimer;
        $(window).on('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (window.Highcharts && window.Highcharts.charts) {
                    window.Highcharts.charts.forEach(function(chart) {
                        if (chart && chart.reflow) chart.reflow();
                    });
                }
                optimizeTableLayout();
            }, 250);
        });
    });
</script>


<div id="reloadHome" class="main-content">
    <div id="loading-halus"></div>
    <div class="row-kpi">
        <div class="kpi-box border-green">
            <h1 id="kpi-active">0</h1>
            <div class="label">
                User Active
                <span class="blink live-window" style="color:var(--accent-green)">‚óè LIVE</span>
            </div>
        </div>
        <div class="kpi-box border-blue">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <h1 id="kpi-sold">0</h1>
                <span id="ghost-tag" style="display:none;" class="ghost-alert blink"><i class="fa fa-search"></i> GHOST</span>
            </div>
            <div class="label">Voucher Terjual (Hari Ini)</div>
        </div>
        <div class="kpi-box border-yellow">
            <h1 id="kpi-income">Rp 0</h1>
            <div class="label" id="kpi-est">Proyeksi: Rp 0</div>
        </div>
        <div class="kpi-box border-audit" id="audit-box">
            <h1 id="audit-status">CLEAR</h1>
            <div class="label" id="audit-val">Selisih: Rp 0</div>
            <div class="audit-detail" id="audit-detail"></div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="card card-chart">
            <div class="card-header">
                <h3><i class="fa fa-line-chart"></i> PERFORMA BISNIS</h3>
                <div class="month-tabs">
                                            <span class="month-tab" data-month="8">Agustus</span>
                                            <span class="month-tab" data-month="10">Oktober</span>
                                            <span class="month-tab" data-month="12">Desember</span>
                                            <span class="month-tab active" data-month="1">Januari</span>
                                    </div>
            </div>
            <div class="card-body" id="r_2_content"></div>
        </div>
        <div class="card card-transaction">
            <div class="card-header">
                <h3><i class="fa fa-history"></i> TRANSAKSI TERAKHIR</h3>
                <span class="blink live-window" style="font-size:10px; font-weight:bold; color:var(--accent-green);">
                    <i class="fa fa-circle"></i> LIVE UPDATE
                </span>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="zoom-resilient table-zoom-fix">
                        <thead>
                            <tr>
                                <th>JAM</th>
                                <th>USER</th>
                                <th class="text-center">BLOK</th>
                                <th class="text-center">STATUS</th>
                                <th class="text-right">UPTIME</th>
                            </tr>
                        </thead>
                        <tbody id="tabel_riwayat">
                            <tr>
                                <td colspan="5" class="text-center" style="padding:40px; color:var(--text-dim);">
                                    <i class="fa fa-spinner fa-spin"></i> Memuat transaksi...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer">
                <span id="row-count">Memuat...</span>
                <span class="live-indicator blink live-window">
                    <i class="fa fa-refresh"></i> Update: <span id="last-update">--:--</span>
                </span>
            </div>
        </div>
    </div>

    <div class="resource-footer" id="r_1_display">
        <span><i class="fa fa-refresh fa-spin"></i> Memuat resource...</span>
    </div>
</div></div>
</div>
</div>
<script src="./js/highcharts/highcharts.js"></script>
<script src="./js/highcharts/themes/hc.dark.js"></script>
<script src="./js/mikhmon-ui.dark.min.js"></script>
<script src="./js/mikhmon.js?t=2026-01-31_14:33:49"></script>

<script>
    if (window.history.replaceState) { window.history.replaceState(null, null, "./?session=S3c7x9_LB"); }
    $("#r_3").load("./dashboard/aload.php?session=S3c7x9_LB&load=logs #r_3");  
    var interval1 = "10000";
    var dashboard = setInterval(function() {
    $("#r_1").load("./dashboard/aload.php?session=S3c7x9_LB&load=sysresource #r_1"); 
    $("#r_2").load("./dashboard/aload.php?session=S3c7x9_LB&load=hotspot #r_2"); 
    $("#r_3").load("./dashboard/aload.php?session=S3c7x9_LB&load=logs #r_3"); 
  }, interval1);
function cancelPage(){ window.stop(); clearInterval(dashboard);} </script></body>
</html>