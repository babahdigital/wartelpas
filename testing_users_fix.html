<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Checklist - Users.php Fix</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1e2226; color: #ecf0f1; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { color: #3498db; margin-bottom: 10px; font-size: 2rem; }
        .version { background: #2ecc71; color: #000; padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 0.85rem; display: inline-block; margin-bottom: 20px; }
        .section { background: #2a3036; padding: 20px; margin-bottom: 20px; border-radius: 8px; border-left: 4px solid #3498db; }
        .section h2 { color: #3498db; margin-bottom: 15px; font-size: 1.3rem; }
        .checklist { list-style: none; }
        .checklist li { padding: 12px; margin: 8px 0; background: #343a40; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; }
        .checklist li:hover { background: #3e444a; transform: translateX(5px); }
        .checklist li input[type="checkbox"] { margin-right: 12px; width: 20px; height: 20px; cursor: pointer; }
        .checklist li.checked { background: rgba(46, 204, 113, 0.2); border-left: 4px solid #2ecc71; }
        .priority { display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 0.75rem; font-weight: bold; margin-left: 10px; }
        .p-high { background: #e74c3c; color: white; }
        .p-med { background: #f39c12; color: white; }
        .p-low { background: #3498db; color: white; }
        .info { background: rgba(52, 152, 219, 0.2); padding: 15px; border-left: 4px solid #3498db; border-radius: 4px; margin-top: 15px; font-size: 0.9rem; }
        .success { background: rgba(46, 204, 113, 0.2); border-left-color: #2ecc71; }
        .warning { background: rgba(243, 156, 18, 0.2); border-left-color: #f39c12; }
        .steps { background: #23272b; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .steps ol { margin-left: 20px; }
        .steps li { margin: 8px 0; color: #adb5bd; }
        .code { background: #1b1e21; color: #2ecc71; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
        .btn { display: inline-block; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 6px; margin: 5px; font-weight: bold; transition: all 0.2s; }
        .btn:hover { background: #2980b9; transform: translateY(-2px); }
        .btn-success { background: #2ecc71; }
        .btn-success:hover { background: #27ae60; }
        .progress-bar { background: #343a40; height: 30px; border-radius: 15px; overflow: hidden; margin: 20px 0; }
        .progress-fill { background: linear-gradient(90deg, #3498db, #2ecc71); height: 100%; width: 0%; transition: width 0.5s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem; }
        .emoji { font-size: 1.2rem; margin-right: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Testing Checklist - users.php Fix</h1>
        <span class="version">Version 2.0 - 19 Jan 2026</span>

        <div class="info success">
            <strong>‚úÖ Status:</strong> Perbaikan sudah diterapkan ke <span class="code">hotspot/users.php</span><br>
            <strong>üìä Database:</strong> SQLite <span class="code">db_data/mikhmon_stats.db</span> (Table: login_history)<br>
            <strong>üîß Perubahan:</strong> 6 Major Fixes + Architecture Improvement
        </div>

        <div class="section">
            <h2>üìä Progress Testing</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0%</div>
            </div>
            <p style="text-align: center; margin-top: 10px; color: #adb5bd;">
                <span id="checkedCount">0</span> dari <span id="totalCount">0</span> test selesai
            </p>
        </div>

        <div class="section">
            <h2><span class="emoji">üî¥</span>Critical Tests - WAJIB</h2>
            <ul class="checklist" data-group="critical">
                <li>
                    <input type="checkbox" id="test1">
                    <label for="test1">
                        <strong>Dropdown Blok Lengkap</strong> <span class="priority p-high">HIGH</span><br>
                        <small>Pilih filter status "Online" ‚Üí Dropdown blok harus menampilkan SEMUA blok (tidak hanya blok yang punya user online)</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test2">
                    <label for="test2">
                        <strong>Dropdown Blok untuk Status "Rusak"</strong> <span class="priority p-high">HIGH</span><br>
                        <small>Pilih filter status "Rusak" ‚Üí Dropdown blok tetap lengkap</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test3">
                    <label for="test3">
                        <strong>Filter Status "Invalid" Tersedia</strong> <span class="priority p-high">HIGH</span><br>
                        <small>Dropdown status harus ada opsi "üî¥ Invalid / Disabled"</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test4">
                    <label for="test4">
                        <strong>Identitas (Blok) Muncul Saat User Online</strong> <span class="priority p-high">HIGH</span><br>
                        <small>Aktifkan 1 user (connect ke hotspot) ‚Üí Kolom "Identitas" di tabel harus tetap menampilkan Blok (misal: BLOK-A)</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test5">
                    <label for="test5">
                        <strong>Identitas Tidak Hilang Setelah Logout</strong> <span class="priority p-high">HIGH</span><br>
                        <small>Setelah user logout/disconnect ‚Üí Identitas (Blok) masih tetap muncul di kolom "Identitas"</small>
                    </label>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2><span class="emoji">üü†</span>Important Tests - Status & Filter</h2>
            <ul class="checklist" data-group="important">
                <li>
                    <input type="checkbox" id="test6">
                    <label for="test6">
                        <strong>Filter Status "Ready" Bekerja</strong> <span class="priority p-med">MEDIUM</span><br>
                        <small>Pilih status "Ready" ‚Üí Hanya user yang belum pernah dipakai yang muncul (exclude online, used, rusak, invalid, retur)</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test7">
                    <label for="test7">
                        <strong>Filter Status "Invalid" Bekerja</strong> <span class="priority p-med">MEDIUM</span><br>
                        <small>Pilih status "Invalid" ‚Üí Hanya user dengan comment "INVALID" atau disabled=yes yang muncul</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test8">
                    <label for="test8">
                        <strong>Filter Status "Used" Akurat</strong> <span class="priority p-med">MEDIUM</span><br>
                        <small>Pilih status "Used" ‚Üí Hanya user yang sudah pernah login tapi SEKARANG offline (exclude yang sedang online)</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test9">
                    <label for="test9">
                        <strong>Identitas Tetap Muncul Saat User RUSAK</strong> <span class="priority p-med">MEDIUM</span><br>
                        <small>Mark 1 user sebagai RUSAK (via tombol retur) ‚Üí Identitas (Blok) tidak boleh hilang</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test10">
                    <label for="test10">
                        <strong>Identitas Tetap Muncul Saat User INVALID</strong> <span class="priority p-med">MEDIUM</span><br>
                        <small>Mark 1 user sebagai INVALID ‚Üí Identitas (Blok) tetap muncul</small>
                    </label>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2><span class="emoji">üü¢</span>Nice to Have - History & Details</h2>
            <ul class="checklist" data-group="nice">
                <li>
                    <input type="checkbox" id="test11">
                    <label for="test11">
                        <strong>IP Address Tersimpan di History</strong> <span class="priority p-low">LOW</span><br>
                        <small>User login ‚Üí Logout ‚Üí IP terakhir tetap muncul di kolom "Koneksi (MAC/IP)"</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test12">
                    <label for="test12">
                        <strong>MAC Address Tersimpan di History</strong> <span class="priority p-low">LOW</span><br>
                        <small>User login ‚Üí Logout ‚Üí MAC address tetap muncul di kolom "Koneksi (MAC/IP)"</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test13">
                    <label for="test13">
                        <strong>Filter Blok Case-Insensitive</strong> <span class="priority p-low">LOW</span><br>
                        <small>Pilih blok "BLOK-A" ‚Üí Sama dengan pilih "blok-a" (tidak case-sensitive)</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test14">
                    <label for="test14">
                        <strong>Kombinasi Filter: Blok + Status</strong> <span class="priority p-low">LOW</span><br>
                        <small>Pilih "BLOK-A" + Status "Online" ‚Üí Hanya user BLOK-A yang online yang muncul</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="test15">
                    <label for="test15">
                        <strong>Search Box Tetap Bekerja</strong> <span class="priority p-low">LOW</span><br>
                        <small>Ketik username di search box ‚Üí Filter bekerja dengan benar</small>
                    </label>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2><span class="emoji">üóÉÔ∏è</span>Database Verification</h2>
            <div class="steps">
                <p><strong>Cara cek data di Database SQLite:</strong></p>
                <ol>
                    <li>Buka terminal/command prompt</li>
                    <li>Navigate ke folder project: <span class="code">cd d:\Data\Projek\wartelpas</span></li>
                    <li>Jalankan query:
                        <div style="background: #1b1e21; padding: 10px; margin: 10px 0; border-radius: 4px; overflow-x: auto;">
                            <code style="color: #2ecc71;">
php -r "try { $db = new PDO('sqlite:db_data/mikhmon_stats.db'); $stmt = $db->query('SELECT username, blok_name, ip_address, mac_address FROM login_history ORDER BY updated_at DESC LIMIT 10'); while($row = $stmt->fetch(PDO::FETCH_ASSOC)) { print_r($row); } } catch(Exception $e) { echo 'Error: ' . $e->getMessage(); }"
                            </code>
                        </div>
                    </li>
                </ol>
            </div>
            <ul class="checklist" data-group="database">
                <li>
                    <input type="checkbox" id="db1">
                    <label for="db1">
                        <strong>Database Terbuat</strong> <span class="priority p-high">HIGH</span><br>
                        <small>File <span class="code">db_data/mikhmon_stats.db</span> ada dan bisa diakses</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="db2">
                    <label for="db2">
                        <strong>Table login_history Ada</strong> <span class="priority p-high">HIGH</span><br>
                        <small>Table login_history dengan kolom username, blok_name, ip_address, mac_address sudah terbuat</small>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="db3">
                    <label for="db3">
                        <strong>Data Tersimpan Otomatis</strong> <span class="priority p-med">MEDIUM</span><br>
                        <small>Setelah user online, data blok + IP + MAC tersimpan di database</small>
                    </label>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2><span class="emoji">‚ö†Ô∏è</span>Known Issues & Workarounds</h2>
            <div class="info warning">
                <p><strong>Jika Identitas Masih Kosong:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Pastikan user pernah login minimal 1x (agar tersimpan ke DB)</li>
                    <li>Pastikan comment di MikroTik mengandung format <span class="code">Blok-XXX</span></li>
                    <li>Cek permission folder <span class="code">db_data/</span> (harus writable)</li>
                    <li>Refresh browser dengan Ctrl+F5 (hard refresh)</li>
                </ol>
            </div>
            <div class="info" style="margin-top: 10px;">
                <p><strong>Jika Dropdown Blok Kosong:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Pastikan ada minimal 1 user dengan format comment <span class="code">Blok-A</span>, <span class="code">Blok-B</span>, dll</li>
                    <li>Clear session: Logout ‚Üí Login kembali</li>
                    <li>Cek query RouterOS API tidak error</li>
                </ol>
            </div>
        </div>

        <div class="section" style="text-align: center;">
            <h2>üìù Submit Testing Report</h2>
            <p style="color: #adb5bd; margin-bottom: 15px;">Setelah selesai testing, simpan hasil dengan tombol di bawah:</p>
            <button class="btn btn-success" onclick="generateReport()">
                <span class="emoji">üìÑ</span> Generate Report
            </button>
            <button class="btn" onclick="resetAll()">
                <span class="emoji">üîÑ</span> Reset All
            </button>
            <a href="./?hotspot=users&session=default" class="btn" style="background: #9b59b6;">
                <span class="emoji">üöÄ</span> Go to Users Page
            </a>
        </div>

        <div class="info" style="margin-top: 20px; font-size: 0.85rem;">
            <strong>üìö Documentation:</strong> Lihat file <span class="code">CHANGELOG_USERS_FIX.md</span> untuk detail lengkap perbaikan.<br>
            <strong>üêõ Bug Report:</strong> Jika menemukan bug, catat di comment dengan detail: Browser, Screenshot, Steps to Reproduce.
        </div>
    </div>

    <script>
        // Initialize
        const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
        const progressBar = document.getElementById('progressBar');
        const checkedCount = document.getElementById('checkedCount');
        const totalCount = document.getElementById('totalCount');

        totalCount.textContent = checkboxes.length;

        // Load saved state
        checkboxes.forEach(cb => {
            const saved = localStorage.getItem(cb.id);
            if (saved === 'true') {
                cb.checked = true;
                cb.parentElement.classList.add('checked');
            }
            cb.addEventListener('change', handleCheck);
        });

        // Handle checkbox change
        function handleCheck(e) {
            const li = e.target.parentElement;
            if (e.target.checked) {
                li.classList.add('checked');
                localStorage.setItem(e.target.id, 'true');
            } else {
                li.classList.remove('checked');
                localStorage.removeItem(e.target.id);
            }
            updateProgress();
        }

        // Update progress bar
        function updateProgress() {
            const checked = document.querySelectorAll('.checklist input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percent = Math.round((checked / total) * 100);
            progressBar.style.width = percent + '%';
            progressBar.textContent = percent + '%';
            checkedCount.textContent = checked;
        }

        // Generate report
        function generateReport() {
            let report = '=== TESTING REPORT - users.php Fix ===\n';
            report += 'Date: ' + new Date().toLocaleString('id-ID') + '\n\n';

            const groups = ['critical', 'important', 'nice', 'database'];
            const groupNames = {
                'critical': 'CRITICAL TESTS',
                'important': 'IMPORTANT TESTS',
                'nice': 'NICE TO HAVE',
                'database': 'DATABASE VERIFICATION'
            };

            groups.forEach(group => {
                const groupChecks = document.querySelectorAll(`[data-group="${group}"] input[type="checkbox"]`);
                const groupChecked = document.querySelectorAll(`[data-group="${group}"] input[type="checkbox"]:checked`).length;
                report += `\n[${groupNames[group]}] - ${groupChecked}/${groupChecks.length} Passed\n`;
                report += '-'.repeat(50) + '\n';
                
                groupChecks.forEach(cb => {
                    const label = cb.nextElementSibling.querySelector('strong').textContent;
                    const status = cb.checked ? '‚úÖ PASS' : '‚ùå FAIL';
                    report += `${status} - ${label}\n`;
                });
            });

            const checked = document.querySelectorAll('.checklist input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percent = Math.round((checked / total) * 100);

            report += '\n' + '='.repeat(50) + '\n';
            report += `OVERALL: ${checked}/${total} tests passed (${percent}%)\n`;
            report += percent === 100 ? 'üéâ ALL TESTS PASSED!' : '‚ö†Ô∏è SOME TESTS FAILED';

            // Download as text file
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'testing_report_' + Date.now() + '.txt';
            a.click();

            alert('Report downloaded! Total: ' + checked + '/' + total + ' tests passed.');
        }

        // Reset all
        function resetAll() {
            if (confirm('Reset semua checklist?')) {
                checkboxes.forEach(cb => {
                    cb.checked = false;
                    cb.parentElement.classList.remove('checked');
                    localStorage.removeItem(cb.id);
                });
                updateProgress();
            }
        }

        // Initial progress update
        updateProgress();
    </script>
</body>
</html>
